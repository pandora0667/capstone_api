# 2018 Capstone 

![](http://pr.hanbat.ac.kr/liveproc/board/download.php?f_index=MjQwMA==%27)



### Project Introduction 

* 본 API 서버는 한밭대학교 정보통신공학과 전자제어공학과 **차량 접촉사고 자동알림 시스템** 구현을 위한 서버입니다. 

* 본 프로젝트에서는 수집기, 디스플레이, 서버로 구성되어 있습니다. 

  * 수집기 : 차량에 부착되어 차량의 정보를 실시간으로 수집합니다. 
    * 평상시 : 가속도, 자이로, 충격센서, 속도, 시간 정보를 전달합니다. 
    * 사고시 : 사고경도, 가속도, 자이로, 충격, 온도, 위치, 시간 정보를 전달합니다. 
  * 디스플레이 : 옵션으로 선택할 수 있으며, 현재 상태를 표시하는데 사용합니다. 
  * 서버 : 수집된 데이터를 처리하고, 사고판단 및 사후 조치에 대한 로직을 반영합니다. 

  

### API SERVER 

* API 서버의 역할은 크게 다음과 같습니다. 
  * 차량 데이터 수집 
  * 차량 데이터 가공 
  * 사고처리 
  * 회원관리 
  * 차량관리 
  * 푸시알림 
* 다음 REST API 기능에 대한 자세한 사용 정보는 다음 링크에서 확인할 수 있습니다. 
  * https://documenter.getpostman.com/view/2212048/RWM8UYBj
*  JAVA 10에 최적화 되어있습니다. 
* Fat Jar인 shadowJar을 사용합니다.  
* Embedded Jetty 9.4.8.v20180619을 사용합니다. 
* postgresql + mybatis를 사용합니다. 
  * 데이터베이스 연결정보는 properties 파일로 관리되며, 다른 인증정보도 이와 같은 방식으로 관리합니다. 
  * 운영자는 데이터베이스 연결정보를 입력해야 하며, DB 테이블 정보는 추후 공개합니다. 
* 서버는 Nginx를 통한 reverse proxy를 통해 LB하며, pinpoint APM을 통해 상태를 모니터링합니다. 
  * 최종 운영서버는 ESXi를 사용하며, Docker로 재배포 됩니다. 



### Business Logic

* 본 로직은 프로젝트의 운영방식으로 추가 회의에 따라서 변동 가능성이 있음을 알립니다. 

  #### 수집기 

  1. 전원인가 후 API 서버에 Hello 패킷(서버가 정상적으로 응답하는지 확인하기 위함)을 보냅니다. 
  2. 서버가 정상적으로 응답하는 경우 자신의 시리얼정보에 등록된 차량과 사용자 아이디를 불러옵니다. 
  3. 등록된 사용자 혹은 차량, 디바이스 정보가 없을 경우 정보가 등록할 때 까지 이후 작업은 수행되지 않습니다. 
  4. 등록된 정보가 있을경우 수집기는 운행정보에 대한 정보를 API 서버로 전송합니다. 
  5. 내부 알고리즘 판단에 근거하여 1차적으로 사고가 났다고 판단했을 경우 사고경도(1~3)을 서버로 전송합니다. 
  6. 급격한 온도변화 혹은 엄청난 충격이 발생한 경우 등 최고 등급으로 서버에 사용자 정보를 최우선적으로 전송합니다. 

  

  	#### 디스플레이 

  * 디스플레이의 경우 옵션 상품으로 수집기와 내부적으로 연동하여 사용자의 정보를 실시간으로 보여주는 역할을 담당합니다. 
  * 장고를 통해 구현하며, 내부로직은 정확히 구현되지 않았기 때문에 추후 업로드 합니다. 



### API SERVER TODO LIST 

- [x] GET, POST, UPDATE, DELETE REST API 구현
- [x] 비밀번호 암호화 구현 
- [x] 마이바티스 적용
- [x] sl4j logger
- [ ] HTTP 예외코드  
- [ ] SSL 적용 
- [ ] 푸시 서비스 구현 (FCM, SMS....)
- [ ] 이메일 발송 서비스 구현 
- [ ] OAUTH2 (Naver, Kakao, Facebook login)
- [ ] 사고 처리 로직 구현 